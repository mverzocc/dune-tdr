%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{System Interfaces}
\label{sec:fdsp-pd-intfc}
%>> Revision: Ernesto Kemp, Yasar Onel & David Warner Apr/12/2019 
%>> Revision: Ernesto Kemp, Yasar Onel & David Warner Jan/08/2019 
%>> Revision: Ernesto Kemp, Yasar Onel, David Warner Nov/23/2018 
%>> Revision: Ernesto Kemp & Norm Buchanan Mar/15/2018 
%>> Start: Ernesto Kemp Feb/10/2018 
\subsection{Overview}
Table~\ref{tbl:SPPDinterfaces} contains a summary and brief description of all the interfaces between the \dword{spmod} \dword{pds} consortium and other consortia, working groups, and task forces, with references to the current version of the interface documents describing those interfaces.  
Drawings of the mechanical interfaces and diagrams of the electrical interfaces are 
included in the interface documents as appropriate.
It is expected that further refinements of the interface documents will take place prior to the final \dword{prr} for the detector. The interface documents specify the responsibility of different consortia or groups during all phases of the experiment including design and prototyping, integration,  installation, and  commissioning.

Additional details describing the interface between the \dword{spmod} \dword{pds} and the other consortia, task forces (TF) and subsystems are given below.

\begin{dunetable}
[Single Phase PD system interface links]
{p{0.25\textwidth}p{0.5\textwidth}l}
{tbl:SPPDinterfaces}
{Single Phase PD system interface links.}
Interfacing System & Description & Linked Reference \\ \toprowrule
Detector Subsystems & &\\ \colhline
\dword{apa} & Mechanical support for PDs, PD installation slots, PD cabling support, access slots & \citedocdb{6667} \\ \colhline
\dword{ce} & Electrical signal interference, grounding, cable routing, cryostat flange, installation and testing & \citedocdb{6718} \\ \colhline
\dword{hv} & Mounting of \dword{pd} monitoring system, possible reflector foil support, electrical discharge or corona effect light contamination & \citedocdb{6721} \\ \colhline
\dword{daq} & Data format, data timing, trigger information, timing and synchronization & \citedocdb{6727} \\ \colhline
\dword{cisc} & Rack layout, flange heaters, power supply selection, power and signal cable selection, monitoring cameras and camera lighting, purity monitor lighting, controls and data monitoring & \citedocdb{6730} \\ \colhline
Technical Coordination & &\\ \colhline
Facility interfaces & Cable trays inside the cryostat, cryostat penetrations, rack layout and power distribution on the detector mezzanine, cable and fiber trays on top of the cryostat & \citedocdb{6970} \\ \colhline
Installation interfaces & Sequence of integration and installation activities at SURF, equipment required for \dword{pd} consortium activities, environmental controls in the cryostat during installation, post-installation testing  & \citedocdb{6997} \\ \colhline
 
Calibration task force interfaces & Interface of \dword{spmod}\ \dword{dp} monitoring system into calibration system. & \citedocdb{7051} \\ \colhline
Physics, Software and Computing interfaces & Covers interfaces between the \dword{pd} group and the joint computing task force, including specifications required for physics, data handling, and computing and storage requirements. & \citedocdb{7105} \\
\end{dunetable}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Anode Plane Assembly}

The interface with the Anode Plane Assembly (APA) represents the most significant mechanical interface for the PD system. Interfaces with the \dword{apa} are involved in meeting specifications SP-PDS-2, SP-PDS-7, SP-PDS-8, SP-PDS-9, SP-PDS-10, SP-PDS-11, and SP-PDS-12 (see Table \ref{tab:specs:SP-PDS}).  The interface document will be written to monitor these specifications.

The APA provides:
\begin{itemize}
\item mechanical support and alignment for the \dword{pd} modules, including access slots through the side of the frame for insertion of modules after the \dword{apa}s are wrapped in wire;
\item mounting support for the PD electrical connections between the \dword{pd} modules and the cable harness mounted inside the \dword{apa} frame;
\item mechanical support and strain relief for PD cables located inside the completed \dword{apa} frame; and
\item provision to connect the \dword{pd} cables from the lower \dword{apa} to the upper \dword{apa} in an assembled \dword{apa} stack and to connect the the 
cables from the top of the \dword{apa} stack to the cryostat flange.
\end{itemize}

Work on the 2-\dword{apa} connection and inspection in the assembly area in the underground assembly area will be performed by the \dword{apa} group. Work on cabling prior to installation is performed by \dword{pds} and \dword{ce} groups under supervision of the \dword{apa} group. Once the \dwords{apa} are moved inside the cryostat, the \dword{pds} and \dword{ce} consortia will be responsible for the routing of the cables in the trays hanging from the top of the cryostat. 

Careful interface control will be required to ensure a successful assembly, which will be guided by the interface control document between the \dword{pd} and \dword{apa} consortia.  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{TPC Cold Electronics}
\label{sec:fdsp-pd-intfc-ce}

Interfaces with the TPC cold electronics are involved in meeting specifications SP-FD-2, SP-PDS-8, and SP-PDS-10 (see Table~\ref{tab:specs:SP-PDS}).  The interface between the \dword{pd} and \dlong{ce} systems primarily consists of:

\begin{itemize}
    %\item ensuring no electrical cross-talk between \dword{pd} and \dword{ce} electronics and cabling harnesses systems;
    \item ensuring no electrical cross-talk between the electronics and cabling harnesses of the \dword{pd} and \dword{ce} systems;
    \item ensuring there be no electrical contact between the \dword{pds} and \dword{ce} components except for sharing a common reference voltage point (ground) at the \fdth{}s;
    \item developing a common cable routing plan allowing the systems to share a common cable tray system on top of the \dword{apa} frame and routing the cables to the cryostat flanges; and 
    \item managing the interface between the \dword{pd} and \dword{ce} flanges in the cryostat cabling tees.
  \end{itemize}  
The \dword{ce} and \dword{pd} use a common cable tray system but separate flanges for the cold-to-warm transition, and each consortium is responsible for the design, procurement, testing, and installation, of their flange on the \fdth{}, together with \dword{lbnf}, which is responsible for the design of the cryostat. 
The installation of the racks on top of the cryostat is a responsibility of the facility, but the exact arrangement of the various crates inside the racks will be reached after common agreement between the \dword{ce}, \dword{pd}, \dword{cisc}, and possibly \dword{daq} consortia. %The \dword{pd} and \dword{ce} consortia will retain all responsibilities for the selection, procurement, testing, and installation of their respective racks, unless for space and cost considerations an agreement is %reached where common crates are used to house low voltage or high/bias voltage modules for both \dword{pd}S and \dword{ce}. 
The \dword{pd} and \dword{ce} consortia will retain all responsibility for selecting, procuring, testing, and installing their respective racks unless space and cost requires an agreement on shared crates to house the low-voltage or high-bias voltage modules for both systems. 

\subsection{Cathode Plane Assembly and High Voltage System}
\label{sec:fdsp-pd-intfc-le}

%EK - Apr/15/19
%\fixme{this will need to be changed if we do eliminate SP-PD-6. Reference to PDS-6 removed but comment on the HV discharge extended 10/11/19 }

%Interfaces with the \dword{hv} system are involved in meeting specifications SP-PDS-6 and SP-PDS-9 (see Table~\ref{tab:specs:SP-PDS}).  % rjw 10/11/19
Interfaces with the \dword{hv} system are should meet mechanical specification SP-PDS-9 (see Table~\ref{tab:specs:SP-PDS}). In addition, light produced in electrical discharges in the \dword{hv} system may increase the PDS data volume and impact the DAQ system. Communication between the three systems has been established on this issue. 

The primary interface between the \dword{pd} and \dword{hv} systems is summarized as follows:
\begin{itemize}
    \item providing an optical fiber routing path and strain relief system to the cryostat calibration hatch;
    \item mounting the \dword{pd} monitoring system light diffusers to the \dword{cpa} faces; and     
    \item minimizing background light due to electrical discharge (corona effects).
\end{itemize} 

%\fixme{added item covering electrical discharge light  DWW:  Done}

This interface has strong overlap with the calibration consortium; this is described in more detail in Section~\ref{sec:fdsp-pd-intfc-calib}.

If the light reflector foil option were to be implemented, production of the FR4+resistive Kapton \dword{cpa} frames will be the responsibility of the \dword{hv} consortium, together with design of the structure for mounting the \dword{pd} reflector foils to the \dword{cpa} structure.  The \dword{hv} consortium will also provide mounting attachment points in the \dword{cpa} frame structure.
 The reflector foils themselves, \dword{tpb} coating of the \dword{wls} foils, and any required hardware for mounting the foils will be the responsibility of the \dword{pd} consortium, with the understanding that all designs and procedures will be approved by the \dword{hv} consortium. 


\subsection{Data Acquisition}
\label{sec:fdsp-pd-intfc-daq}

%\fixme{ This will also need fixing if Anne and Eric are OK with the changes to the specifications dww 10/11/19}

Interfaces with the \dword{daq} system are involved in meeting specifications SP-PDS-5
%, SP-PD-6 
and SP-PDS-13 (see Table~\ref{tab:specs:SP-PDS}).  The \dword{pds} interfaces with the Data Acquisition (DAQ) system are described in \citedocdb{6727} and include

\begin{itemize}

\item Data Physical Links: Data are passed from the \dword{pd} to the \dword{daq} on 25 optical links following the 1000Base-SX standard. The links run from the \dword{pd} readout system on the cryostat to the \dword{daq} system in the \dword{cuc}.

\item Data Format: Data are encoded using UDP/IP.  The data format consists of a header containing the word count, event time stamp, and channel ID, followed by the digitized waveform in \SI{80}{MHz} samples.
%EK - Apr/18/2019
The data format has also been specified to use compression (zero suppression) and custom communication protocol.

\item Data Timing: The data must contain enough information to identify the time at which it was taken.

\item Trigger Information: The \dword{pd} may provide summary information useful for data selection. If present, this will be passed to the \dword{daq} on the same physical links as the remaining data.

\item Timing and Synchronization: Clock and synchronization messages will be propagated from the \dword{daq} to the \dword{pd} using a backwards compatible development of the \dword{pdsp} timing system protocol~\cite{bib:docdb1651}. There will be at least one timing fiber available for each data link coming from the \dword{pds}. 

\item Power-on initialization and start-of-run setup:  The \dword{pd}S may require initialization and setup on power-on and start of run. Power on initialization should not require communication with the \dword{daq}. Start run/stop run and synchronization signals such as accelerator spill information will be passed by the timing system interface.

\end{itemize}

%EK - Apr/18/2019
The data format has been determined but it is possible to include additional summary information to the header that depends on the outcome of triggering studies underway. This minor potential modification can be accommodated easily.

%\fixme{I added text about light leaks and streamers.  Too much? dww and edit by rjw 10/13/19}

Excessive \dword{pd} data may be generated by background effects such as light leaks in the cryostat or light generated due to sporadic short duration current discharge from the HV system (referred to as ``micro-discharges'' or as ``streamers'' in \dword{pdsp}).  The \dword{hv} consortium is trying to reduce the rate at which the discharges happen, but it is not expected to be completely eliminated. 

In the case of light leaks, specification SP-PD-05 limits the acceptable data generated by these leaks to  less than 10\% of the total data transfer rate from the \dword{pd} to the \dword{daq}.
Light flashes due to HV micro-discharges may be harder to mitigate, but the experience of streamers producing light in \dword{pdsp} informs what we are likely to experience in \dword{dune} and indicates that there is low risk that it will be a serious problem:

\begin{itemize}
  
\item They occur at a relatively low rate: once per few hours in \dword{pdsp}, likely much less underground due to the much lower cosmic ray ray that generates charge in the TPC.

\item When they occur, they produce a significant amount of light but in a localized region (this was observed in the \dword{pdsp} \dword{pds}).

\end{itemize}

There is an automatic mitigation scheme in the \dword{hv} system slow control that can identify when micro-discharges occur and stop them, but the power supply data is read relatively slowly (a few Hz) compared to the timescale of the \dword{pd}/\dword{daq}. Data corresponding to the \dword{pd} response to the light flash will have already been recorded by the \dword{daq} before the \dword{hv} system can respond, so the mitigation will likely need to be a function of the \dword{daq}.

In summary, since electrical discharges from the HV system are not under the control of the \dword{pds} it is not directly a specification for the \dword{pds}.  
%and care must be taken to avoid placing unnecessary specifications on the \dword{hv} consortium regarding micro-discharging that might negatively impact or increase risk for the \dword{hv} system design. 
%\dword{pdsp} experience also suggests that significant light from these events may be seen by the \dword{pd}. 
Following consultation with the \dword{daq} and \dword{hv} consortia, we determined that it is also not appropriate as a specification on the \dword{hv} system but is better addressed in the \dword{daq}/\dword{pd} interface document.


\subsection{Cryogenics Instrumentation and Slow Control}
\label{sec:fdsp-pd-intfc-xeon}

The primary interactions between the \dword{pd} and the \dword{cisc} include

\begin{itemize}
    \item warm electronics rack controls, power supplies, rack safety equipment;
    \item warm cable and connector selection;
    \item cryogenic camera systems for detector monitoring, including lighting systems;
    \item purity monitor lighting requirements;
    \item cryostat flanges required for PD signal cable and monitoring systems; and
    \item \dword{pd} slow control (including bias voltage) and data monitoring.
\end{itemize}

Additional interaction may occur in the case that the xenon doping performance enhancement is selected for inclusion in the detector.  This system requires pre-mixing xenon gas and argon gas to introduce xenon doping into the \lar volume. 


Any required hardware for this enhancement will be the responsibility of the Photon Detection consortium, with the understanding that all designs and procedures will be approved in advance by the Cryogenics group. 

%\fixme{DWW 10/11/19 Do we want to add this rjw I guess it is okay to include this heads up. I doubt it will be noticed but if it raises questions that isn't a bad thing since the issues do need to be understood.}

A proposal is under consideration to mount \dword{cisc} temperature sensors inside the \dword{apa} frames, sharing a readout cable routing inside the \dword{apa} frames and upper-to-lower \dword{apa} connection point with the \dword{pd}.  This decision will be reached prior to the 60\% design review.  In case this plan is adapted, all \dword{pd} cables and connectors will be the responsibility of the \dword{pd} consortium, and all \dword{cisc} components, cables, and connectors will be the responsibility of the \dword{cisc} consortium.  Cable routing plans, junction plates, and cable fixation will be the responsibility of the \dword{pd} consortium.

\subsection{Facility, Integration and Installation Interfaces}

%EK - Apr/15/19
The interface document with the project interface and installation working group covers the interface of the \dword{pd} group with the technical coordination groups who oversee the integration of the \dword{pd} modules and electronics into the \dword{apa} and \dword{daq}. Interfaces with the facility, integration, and installation group are involved in meeting specifications SP-PDS-1, SP-PDS-3, SP-PDS-4, and SP-PDS-5 (see Table~\ref{tab:specs:SP-PDS}).  The interfaces are distributed among the facility, integration, and installation working groups and primarily consist of
\begin{itemize}
    \item electrical racks, cable trays, and cryostat penetrations, and power distribution on the mezzanine;
    \item storage for arriving \dword{pd} modules prior to their integration;
    %Facilities group
    \item planning of pre-integration tests of \dword{pd} components at the integration area and required equipment/tools;
    %Integration group
    \item sequence of integration and installation activities at SURF (including environmental controls);
    \item quality management testing of \dword{pd} modules during integration and installation;
    %Installation group
    \item equipment required for \dword{pd} consortium activities; and
    %Installation group
    \item environmental controls in the cryostat during installation, and post-installation testing.
\end{itemize}

The \dword{pd} consortium retains responsibility for providing quality management tooling and test plans at the integration area, as well as specialized labor and supervisory personnel for \dword{pd} module integration and installation. Distribution of these responsibilities is described in~\citedocdb{6970}. %the  \dword{sp}  covered in the Integration \dword{pd} consortium interface document.

The installation is described in detail in 
Volume~\volnumbertc{}, \voltitletc{}.


\subsection{Calibration and Monitoring}
\label{sec:fdsp-pd-intfc-calib}

% EK, April/15
This subsection concentrates on the description of the interface between the SP-\dword{pd} and Calibration/Monitoring Task Force (CTF).
Main interface items are
\begin{itemize}
    \item cold components: light sources (diffusers and fibers) placed on the cathode planes to illuminate the detectors;
    \item warm components: a controlled pulsed-UV source and warm optics; and 
    %These warm components interface calibration and monitoring  with the \dword{cisc} and \dword{daq} subsystems, and are described in corresponding documents (\citedocdb{6730} and \citedocdb{6727} respectively).
    \item the optical \fdth: used to \dword{pd} bring monitoring system fiber optics through the calibration and monitoring flange.  The flange itself is a shared interface between the \dword{pds}, the calibration task force, and \dword{cisc}.
\end{itemize}

Hardware components required for \dword{pd} monitoring and calibration systems will be designed and fabricated by the \dword{sp}-\dword{pds} consortium. 

Cold components (diffusers and fibers) interface with \dword{hv} and are described in a separate interface document (\citedocdb{6721}). Warm components interface the \dword{pd} calibration and monitoring subsystem with the \dword{cisc}~\citedocdb{6730} and \dword{daq}~\citedocdb{6727} subsystems.
%==========================================

A joint development effort with HV/\dword{cpa} groups will define the optimization of materials and location of the photon diffusers, fiber routes, connectors location and also the installation procedure of the diffusers and fiber. The feedthrough ports/locations and fiber routing along DSS will be determined jointly by SP-PDS and Cryostat/DSS groups. The calibration TF and PD system group will share rack spaces. Multi-purpose ports are planned to be shared between various groups, calibration devices such as lasers and cameras will make use of them. CTF and SP-PDS will define the ports for deployment. An interlock system to avoid turning on light sources when the PD system is in operation will be provided.

\subsection{Physics, Software and Computing}

%\fixme{this will need fixing as well if we eliminate SP-PD-6; comment that our 10/11/19}

Interfaces with physics, software, and computing are involved in meeting specifications SP-FD-3, SP-FD-4, SP-PDS-2, SP-PDS-5, 
%SP-PDS-6, 
SP-PDS-14, SP-PDS-15, and SP-PDS-16 (see Table \ref{tab:specs:SP-PDS}). The physics topics covered by the
\dword{snb}/low energy and \dword{ndk}/\dword{hep} working groups are the most closely connected to the \single \dword{pds}. The connection stems from the need for self-triggering for DUNE non-beam physics addressed by these two groups. 
However, there are connections to all physics working groups involving far detector observables, as scintillation light information will improve event reconstruction/classification beyond what is achievable by TPC information only. 

Below is a summary of interfaces between the \dune \single \dword{pds} and \dword{fd} and \dword{pdsp} Simulation/Reconstruction groups:

\begin{itemize}
    \item generating photon libraries, and the tools for doing so;
    \item simulating and evaluating performance of physics events;
    \item \single \dword{pds} reconstruction performance studies;
    \item algorithms for matching flashes to \dword{tpc} tracks; and
    \item analyzing the light produced by various species of charged particles.
\end{itemize}

It is critical that the performance specifications for the \dword{pds} meet the needs of the physics and reconstruction teams, both in terms of detector performance and background (including false triggers from radiologicals and light contamination from cryostat light leaks, HV system corona discharges, and calibration system effects such as purity monitors, laser flashers and cameras.  These interfaces will be captured here.
Light contamination of any nature must be studied quantitatively so that the impact on error budget due to misclassification of events can be calculated. Quantitative indicators should be established using \dword{pdsp} data, which should also provide the basis for identification algorithms of spurious signals caused by light leakage. 

The SP \dword{pds} shares interfaces with the DUNE core computing systems, primarily with databases. The two databases that will have direct interfaces with the SP \dword{pds} are the hardware/QC and calibration databases. All the off-line calibration values will be stored in the DUNE calibration database. Additionally, the system will interface with the DUNE hardware database. During all stages of production/procurement and QC evaluations of \dword{pds} components, as well as integration and installation of the system, tracking of the hardware, and test results will be stored in the DUNE hardware/QC database. The SP \dword{pds} consortium will work with the database group to ensure that all schema, applications, and procedures for the database interfaces are developed. As components of the system will originate at multiple institutions, well defined procedures and management will be required to ensure that all data is archived in the DUNE hardware/QC database. 
